<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="/styles.css">
    <title>Chatbox</title>
    <style>
        #chatbox {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div id="chatbox"></div>
    <input type="text" id="userInput" placeholder="Type your message...">
    <button id="sendButton">Send</button>

    <script>
        var chatbox = document.getElementById("chatbox");
        var userInput = document.getElementById("userInput");
        var sendButton = document.getElementById("sendButton");
        var conversation = [];

        function saveConversation() {
            var filename = "text.md";
            var content = "";

            for (var i = 0; i < conversation.length; i++) {
                var message = conversation[i];
                content += message.sender + ": " + message.content + "\n";
            }

            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("POST", "save_conversation.php", true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                    console.log("Conversation saved to " + filename);
                }
            };
            xmlhttp.send("filename=" + filename + "&content=" + encodeURIComponent(content));
        }

        function retrievePreviousQuestions() {
            var filename = "test.md";

            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET", "retrieve_questions.php?filename=" + filename, true);
            xmlhttp.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                    var previousQuestions = this.responseText;
                    chatbox.innerHTML = previousQuestions;
                    scrollToBottom();
                }
            };
            xmlhttp.send();
        }

        function addMessage(sender, content) {
            var messageElement = document.createElement("p");
            messageElement.innerHTML = "<strong>" + sender + ":</strong> " + content;
            chatbox.appendChild(messageElement);
        }

        function addUserMessage() {
            var userInputValue = userInput.value;
            if (userInputValue.trim() !== "") {
                addMessage("User", userInputValue);
                conversation.push({ sender: "User", content: userInputValue });
                userInput.value = "";
                scrollToBottom();
                saveConversation();
            }
        }

        function scrollToBottom() {
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        userInput.addEventListener("keypress", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                sendButton.click();
            }
        });

        sendButton.addEventListener("click", function() {
            addUserMessage();
        });

        window.addEventListener("load", function() {
            retrievePreviousQuestions();
        });
    </script>
</body>
</html>